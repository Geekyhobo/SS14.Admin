@page "/bans"
@using Microsoft.AspNetCore.Components.QuickGrid
@using SS14.Admin.Admins
@using SS14.Admin.Helpers
@using SS14.Admin.Components.Forms

<PageTitle>Bans</PageTitle>

<h1 class="text-2xl font-bold mb-4">Bans</h1>

<div class="flex gap-2 mb-4">
    <AuthorizeView Roles="@AdminFlags.MassBan.RoleName()">
        <Authorized>
            <NavLink href="/bans/createmassban" class="button button-primary">Create new Mass Ban</NavLink>
        </Authorized>
    </AuthorizeView>
    <AuthorizeView Roles="@AdminFlags.Ban.RoleName()">
        <Authorized>
            <NavLink href="/bans/createban" class="button button-primary">Create new Ban</NavLink>
        </Authorized>
    </AuthorizeView>
</div>

<BanFilter Filter="_model" FormName="banFilter" OnSubmit="@OnFilterSubmit" />

<QuickGrid TItem="BanViewModel"
           @ref="Grid"
           Items="@_bansList.AsQueryable()"
           Pagination="@_pagination"
           Class="grow">
    <PropertyColumn Property="@(ban => ban.PlayerName)" Title="Name"></PropertyColumn>
    <PropertyColumn Property="@(ban => RedactIp(ban.IPAddress))" Title="IP"></PropertyColumn>
    <PropertyColumn Property="@(ban => RedactHwid(ban.Hwid))" Title="HWID"></PropertyColumn>
    <PropertyColumn Property="@(ban => ban.PlayerUserId)" Title="GUID"></PropertyColumn>
    <PropertyColumn Property="@(ban => ban.Reason)" Title="Reason"></PropertyColumn>
    <PropertyColumn Property="@(ban => ban.BanTime)" Title="Ban Time" Format="yyyy-MM-dd HH:mm:ss"
                    Sortable="true"></PropertyColumn>
    <PropertyColumn Property="@(ban => ban.ExpirationTime)" Title="Expires" Format="yyyy-MM-dd HH:mm:ss"
                    Sortable="true"></PropertyColumn>
    <PropertyColumn Property="@(ban => ban.Admin)" Title="Banning Admin"></PropertyColumn>
    <TemplateColumn Title="Hits">
        @if (context.HitCount > 0)
        {
            <NavLink href="@($"/bans/{context.Id.ToString()}/hits")" class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">
                @context.HitCount
            </NavLink>
        }
        else
        {
            <span class="text-gray-500">0</span>
        }
    </TemplateColumn>
    <TemplateColumn Title="Actions">
        @if (context.Active)
        {
            @if (!_confirmations.ContainsKey(context.Id) || !_confirmations[context.Id])
            {
                <button class="btn btn-secondary px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white rounded"
                        @onclick="() => ShowConfirmation(context.Id, context.Active)">
                    Unban
                </button>
            }
            else
            {
                <button class="btn btn-danger px-3 py-1 bg-red-500 hover:bg-red-600 rounded text-white"
                        @onclick="() => ConfirmAction(context.Id, context.Active)">
                    Are you sure?
                </button>
            }
        }
        else
        {
            <span class="text-gray-500 italic">Already unbanned/expired</span>
        }
    </TemplateColumn>
</QuickGrid>
<Pagination OnRefreshRequired="Refresh" class="py-2 border-t bg-primary-1 sticky-pagination" State="@_pagination"/>
