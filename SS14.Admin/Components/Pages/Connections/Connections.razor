@page "/connections"
@using Microsoft.AspNetCore.Components.QuickGrid
@using SS14.Admin.Components.Forms

<PageTitle>Connections</PageTitle>

<h1 class="text-2xl font-bold mb-4">Connection Logs</h1>

<ConnectionFilter Filter="@_filter" FormName="ConnectionsPageFilterForm" OnSubmit="RefreshFilter" />

<QuickGrid
    @ref="Grid"
    ItemsProvider="@_connectionsProvider"
    Pagination="@_pagination"
    Class="grow">

    <PropertyColumn Property="@(c => c.Time)" Title="Time" Sortable="true" IsDefaultSortColumn InitialSortDirection="SortDirection.Descending" Format="yyyy-MM-dd HH:mm:ss" Class="text-primary-1 w-48"></PropertyColumn>
    <PropertyColumn Property="@(c => c.UserName)" Title="Username" Sortable="true" Class="text-primary-1"></PropertyColumn>
    <PropertyColumn Property="@(c => c.UserId)" Title="User ID" Class="text-primary-1 font-mono text-sm"></PropertyColumn>
    <PropertyColumn Property="@(c => c.Address)" Title="IP Address" Class="text-primary-1 font-mono text-sm"></PropertyColumn>
    <PropertyColumn Property="@(c => c.HWId)" Title="HWID" Class="text-primary-1 font-mono text-sm"></PropertyColumn>
    <PropertyColumn Property="@(c => c.ServerName)" Title="Server" Sortable="true" Class="text-primary-1"></PropertyColumn>
    <TemplateColumn Title="Status" SortBy="@(GridSort<ConnectionViewModel>.ByAscending(c => c.Denied))">
        @if (context.Denied == null)
        {
            <span class="text-green-600 dark:text-green-400 font-bold">Accepted</span>
        }
        else
        {
            <span class="text-red-600 dark:text-red-400 font-bold">@context.Denied</span>
        }
    </TemplateColumn>
    <TemplateColumn Title="Ban Hits">
        @if (context.BanHitCount > 0)
        {
            <NavLink href="@($"/connections/{context.Id}/hits")" class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">
                @context.BanHitCount
            </NavLink>
        }
        else
        {
            <span class="text-gray-500">0</span>
        }
    </TemplateColumn>
</QuickGrid>

<Pagination OnRefreshRequired="Refresh" ShowPerPage="false" class="py-2 border-t sticky-pagination" State="@_pagination" />
